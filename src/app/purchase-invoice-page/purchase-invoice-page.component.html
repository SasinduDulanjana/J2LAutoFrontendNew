<div class="bill-popup-container" id="purchase-invoice-content">
  <!-- Header with Letterhead -->
  <div class="bill-popup-header" style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 18px; border-bottom: 2px solid #eaeaea; padding-bottom: 12px;">
    <div style="margin-bottom: 8px;">
      <img src="assets/img/letterhead.png" alt="True Enterprises Letterhead" style="height:80px; max-width:100%; object-fit:contain; display: block; margin: 0 auto;" />
    </div>
  </div>

  <!-- Title -->
  <div class="bill-title">Purchase Entry</div>

  <!-- Meta Information -->
  <div class="bill-meta">
    <div><span class="meta-label">Invoice No:</span> <span class="meta-value">{{ invoiceData.invoiceNumber }}</span></div>
    <div><span class="meta-label">Date:</span> <span class="meta-value">{{ invoiceData.currentDate }}</span></div>
    <div><span class="meta-label">Supplier:</span> <span class="meta-value">{{ invoiceData.supplierName }}</span></div>
    <div><span class="meta-label">User:</span> <span class="meta-value">{{ invoiceData.loggedUserName }}</span></div>
  </div>

  <!-- Product Table -->
  <table class="bill-popup-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Product Name</th>
        <th>Batch</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Discount (%)</th>
        <th>Discount</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of invoiceData.saleItems; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ item.productName }}</td>
        <td>{{ item.batchNo }}</td>
        <td>{{ item.remainingQty }}</td>
        <td>{{ item.retailPrice | currency: 'LKR ' }}</td>
        <td>{{ item.discountPercentage ?? 0 }}%</td>
        <td>{{ ((item.discountPercentage ?? 0) / 100 * (item.retailPrice ?? 0) * (item.remainingQty ?? 0)) | currency: 'LKR ' }}</td>
        <td>{{ ((item.remainingQty ?? 0) * (item.retailPrice ?? 0) - ((item.discountPercentage ?? 0) / 100 * (item.retailPrice ?? 0) * (item.remainingQty ?? 0))) | currency: 'LKR ' }}</td>
      </tr>
    </tbody>
  </table>

  <!-- Summary Section -->
  <div class="bill-popup-summary">
    <div class="summary-row"><span>Subtotal:</span> <span>{{ invoiceData.subtotal | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Line Wise Discount Total:</span> <span>{{ invoiceData.totalDiscount | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Bill Wise Discount (%):</span> <span>{{ invoiceData.billWiseDiscountPercentage }}%</span></div>
    <div class="summary-row"><span>Bill Wise Discount Total:</span> <span>{{ invoiceData.billWiseDiscountTotal | currency: 'LKR ' }}</span></div>
    <div class="summary-row net-total"><span>Net Total:</span> <span>{{ invoiceData.netTotal | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Paid Amount:</span> <span>{{ invoiceData.saleItem.paidAmount | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Status:</span> 
      <span class="status-value" [ngClass]="{'paid': invoiceData.saleItem.isFullyPaid, 'unpaid': !invoiceData.saleItem.isFullyPaid}">
        {{ invoiceData.saleItem.isFullyPaid ? 'Fully Paid' : 'Partially Paid' }}
      </span>
    </div>
  </div>

  <!-- Buttons -->
  <div class="bill-popup-actions">
    <button (click)="printBill()" class="btn btn-success"><i class="fa fa-print"></i> Print Invoice</button>
    <button (click)="startNewTransaction()" class="btn btn-success" style="margin-left: 12px;"><i class="fa fa-plus"></i> New Purchase</button>
  </div>

  <!-- Footer -->
  <div class="bill-popup-footer">
   
    <div class="footer-note">This is a system generated entry. For inquiries, contact trueenterprises.lk@gmail.com</div>
  </div>
</div>
