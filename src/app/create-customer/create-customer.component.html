<div class="container py-4">
  <div *ngIf="loading" class="loading-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:rgba(255,255,255,0.6);display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div style="font-size:1.2rem;color:#0d6efd;font-weight:500;">Creating customer...</div>
  </div>
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white d-flex align-items-center">
      <svg cIcon name="cil-user-follow" class="me-2"></svg>
      <h4 class="mb-0">Create Customer</h4>
    </div>
    <div class="card-body">
      <form (ngSubmit)="createCustomer()" #customerForm="ngForm" cForm class="row g-4">
        <c-col [md]="6">
          <label cLabel for="companyName">Company Name</label>
          <input cFormControl id="companyName" type="text" [(ngModel)]="companyName" name="companyName" minlength="2" required #companyNameCtrl="ngModel" />
          <div *ngIf="companyNameCtrl.invalid && (companyNameCtrl.dirty || companyNameCtrl.touched)" class="text-danger small">
            <div *ngIf="companyNameCtrl.errors?.['required']">Company Name is required.</div>
            <div *ngIf="companyNameCtrl.errors?.['minlength']">Company Name must be at least 2 characters.</div>
          </div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="name">Customer Name</label>
          <input cFormControl id="name" type="text" [(ngModel)]="customer.name" name="name" required #name="ngModel" minlength="2" />
          <div *ngIf="name.invalid && (name.dirty || name.touched)" class="text-danger small">
            <div *ngIf="name.errors?.['required']">Name is required.</div>
            <div *ngIf="name.errors?.['minlength']">Name must be at least 2 characters.</div>
          </div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="email">Email</label>
          <input cFormControl id="email" type="email" [(ngModel)]="customer.email" name="email" #email="ngModel" email />
          <div *ngIf="email.invalid && (email.dirty || email.touched)" class="text-danger small">
            <div *ngIf="email.errors?.['email']">Invalid email format.</div>
          </div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="phone">Phone Number</label>
          <div class="input-group">
            <select class="form-select" style="max-width:110px; min-width:90px; text-align:left; padding-right:1.5em;" name="countryCode" required>
              <option value="+94">+94&nbsp;&nbsp;LK</option>
              <option value="+91">+91&nbsp;&nbsp;IN</option>
              <option value="+1">+1&nbsp;&nbsp;US</option>
              <option value="+44">+44&nbsp;&nbsp;UK</option>
              <!-- Add more country codes as needed -->
            </select>
            <input cFormControl id="phone" type="text" [(ngModel)]="customer.phone" name="phone" required #phone="ngModel" pattern="^[0-9]{9}$" (ngModelChange)="onPhoneChange($event)" class="form-control" />
          </div>
          <div *ngIf="phone.invalid && (phone.dirty || phone.touched)" class="text-danger small">
            <div *ngIf="phone.errors?.['required']">Phone number is required.</div>
            <div *ngIf="phone.errors?.['pattern']">Phone number must be exactly 9 digits (without country code).</div>
          </div>
          <div *ngIf="phoneExists" class="text-danger small">Phone number already exists!</div>
        </c-col>
        <c-col [md]="12">
          <label cLabel for="address">Address</label>
          <input cFormControl id="address" type="text" [(ngModel)]="customer.address" name="address" required #address="ngModel" minlength="3" />
          <!-- <div *ngIf="address.invalid && (address.dirty || address.touched)" class="text-danger small"> -->
            <!-- <div *ngIf="address.errors?.['required']">Address is required.</div> -->
            <!-- <div *ngIf="address.errors?.['minlength']">Address must be at least 3 characters.</div> -->
          <!-- </div> -->
        </c-col>
        <c-col [md]="12" class="text-end">
          <button cButton color="primary" type="submit" [disabled]="!customerForm.form.valid || phoneExists">
            <svg cIcon name="cil-save" class="me-2"></svg>Save Customer
          </button>
        </c-col>
      </form>
    </div>
  </div>
</div>
