

<div class="bill-popup-container">
  <div class="bill-popup-header">
    <div class="company-info">
      <div class="company-name">SmartPOS Solutions Pvt Ltd</div>
      <div class="company-address">123 Main Street, Colombo, Sri Lanka</div>
      <div class="company-contact">Tel: +94 11 123 4567 | Email: info@smartpos.lk</div>
    </div>
    <div class="bill-title">Sale Invoice</div>
    <div class="bill-meta">
      <div><span class="meta-label">Invoice No:</span> <span class="meta-value">{{ invoiceNumber }}</span></div>
      <div><span class="meta-label">Date:</span> <span class="meta-value">{{ currentDate }}</span></div>
      <div><span class="meta-label">Customer:</span> <span class="meta-value">{{ selectedCustomerName }}</span></div>
      <div><span class="meta-label">User:</span> <span class="meta-value">{{ loggedUserName }}</span></div>
    </div>
  </div>

  <table class="bill-popup-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Product Name</th>
        <th>Batch</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Discount (%)</th>
        <th>Discount</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of saleItems; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ item.productName }}</td>
        <td>{{ item.batchNo }}</td>
        <td>{{ item.remainingQty }}</td>
        <td>{{ item.retailPrice | currency: 'LKR ' }}</td>
        <td>{{ item.discountPercentage ?? 0 }}%</td>
        <td>{{ ((item.discountPercentage ?? 0) / 100 * (item.retailPrice ?? 0) * (item.remainingQty ?? 0)) | currency: 'LKR ' }}</td>
        <td>{{ ((item.remainingQty ?? 0) * (item.retailPrice ?? 0) - ((item.discountPercentage ?? 0) / 100 * (item.retailPrice ?? 0) * (item.remainingQty ?? 0))) | currency: 'LKR ' }}</td>
      </tr>
    </tbody>
  </table>

  <div class="bill-popup-summary">
    <div class="summary-row"><span>Subtotal:</span> <span>{{ getSubtotal() | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Line Wise Discount Total:</span> <span>{{ getTotalDiscount() | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Bill Wise Discount (%):</span> <span>{{ billWiseDiscountPercentage }}%</span></div>
    <div class="summary-row"><span>Bill Wise Discount Total:</span> <span>{{ getTotalBillWiseDiscount() | currency: 'LKR ' }}</span></div>
    <div class="summary-row net-total"><span>Net Total:</span> <span>{{ getTotal() | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Paid Amount:</span> <span>{{ saleItem.paidAmount | currency: 'LKR ' }}</span></div>
    <div class="summary-row"><span>Status:</span> <span class="status-value" [ngClass]="{'paid': saleItem.isFullyPaid, 'unpaid': !saleItem.isFullyPaid}">{{ saleItem.isFullyPaid ? 'Fully Paid' : 'Partially Paid' }}</span></div>
  </div>

  <div class="bill-popup-actions">
    <button (click)="printBill()" class="btn btn-success"><i class="fa fa-print"></i> Print Bill</button>
  </div>

  <div class="bill-popup-footer">
    <div class="thank-you">Thank you for your business!</div>
    <div class="footer-note">This is a system generated invoice. If you have any questions, contact us at info@smartpos.lk</div>
  </div>
</div>
