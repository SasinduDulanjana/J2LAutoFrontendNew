<div class="container py-4">
  <div *ngIf="loading" class="loading-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:rgba(255,255,255,0.6);display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div style="font-size:1.2rem;color:#0d6efd;font-weight:500;">Updating product...</div>
  </div>
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white d-flex align-items-center">
      <svg cIcon name="cil-pencil" class="me-2"></svg>
      <h4 class="mb-0">Update Product</h4>
    </div>
    <div class="card-body">
      <form (ngSubmit)="saveProduct()" #productForm="ngForm" cForm class="row g-4">
        <c-col [md]="6">
          <label cLabel for="productName">Name</label>
          <input cFormControl id="productName" type="text" [(ngModel)]="product.productName" name="productName" required minlength="2" #productName="ngModel" />
          <div *ngIf="productName.invalid && (productName.dirty || productName.touched)" class="text-danger small">
            <div *ngIf="productName.errors?.['required']">Product name is required.</div>
            <div *ngIf="productName.errors?.['minlength']">Product name must be at least 2 characters.</div>
          </div>
        </c-col>
        <c-col [md]="6">
          <div class="mb-3">
            <label cLabel for="category" class="form-label">Category</label>
            <select cFormControl id="category" [(ngModel)]="selectedParentCategoryId" name="category" required class="form-select">
              <option value="" disabled selected>Select Category</option>
              <option *ngFor="let category of categories" [value]="category.catId">{{ category.name }}</option>
            </select>
          </div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="barCode">Barcode</label>
          <input cFormControl id="barCode" type="text" [(ngModel)]="product.barCode" name="barCode" required minlength="3" #barCode="ngModel" (ngModelChange)="onBarcodeChange($event)" />
          <div *ngIf="barCode.invalid && (barCode.dirty || barCode.touched)" class="text-danger small">
            <div *ngIf="barCode.errors?.['required']">Barcode is required.</div>
            <div *ngIf="barCode.errors?.['minlength']">Barcode must be at least 3 characters.</div>
          </div>
          <div *ngIf="barcodeExists" class="text-danger small">Barcode already exists. Please enter a unique Barcode.</div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="sku">SKU</label>
          <input cFormControl id="sku" [(ngModel)]="product.sku" name="sku" required minlength="2" #sku="ngModel" (ngModelChange)="onSkuChange($event)" />
          <div *ngIf="sku.invalid && (sku.dirty || sku.touched)" class="text-danger small">
            <div *ngIf="sku.errors?.['required']">SKU is required.</div>
            <div *ngIf="sku.errors?.['minlength']">SKU must be at least 2 characters.</div>
          </div>
          <div *ngIf="skuExists" class="text-danger small">SKU already exists. Please enter a unique SKU.</div>
        </c-col>
        <!-- Product Type -->
        <!-- <c-col [md]="6">
          <label cLabel for="productType">Product Type</label>
          <select cFormControl id="productType" [(ngModel)]="product.productType" name="productType" required #productType="ngModel" class="form-select">
            <option value="" disabled selected>Select Product Type</option>
            <option value="Standard Product">Standard Product</option>
            <option value="Variable Product">Variable Product</option>
            <option value="Service Product">Service Product</option>
          </select>
          <div *ngIf="productType.invalid && (productType.dirty || productType.touched)" class="text-danger small">
            <div *ngIf="productType.errors?.['required']">Product type is required.</div>
          </div>
        </c-col> -->
        <c-col [md]="6">
          <label cLabel for="lowQty">Low Qty</label>
          <input cFormControl id="lowQty" [(ngModel)]="product.lowQty" name="lowQty" required pattern="^[0-9]+$" #lowQty="ngModel" />
          <div *ngIf="lowQty.invalid && (lowQty.dirty || lowQty.touched)" class="text-danger small">
            <div *ngIf="lowQty.errors?.['required']">Low Qty is required.</div>
            <div *ngIf="lowQty.errors?.['pattern']">Low Qty must be a number.</div>
          </div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="description">Description</label>
          <textarea cFormControl id="description" [(ngModel)]="product.description" name="description" rows="2" required minlength="3" #description="ngModel"></textarea>
          <div *ngIf="description.invalid && (description.dirty || description.touched)" class="text-danger small">
            <div *ngIf="description.errors?.['required']">Description is required.</div>
            <div *ngIf="description.errors?.['minlength']">Description must be at least 3 characters.</div>
          </div>
        </c-col>
        
        <!-- <c-col [md]="4">
          <label cLabel for="taxGroup">Tax Group</label>
          <input cFormControl id="taxGroup" [(ngModel)]="product.taxGroup" name="taxGroup" />
        </c-col>
        <c-col [md]="4">
          <label cLabel for="taxType">Tax Type</label>
          <input cFormControl id="taxType" [(ngModel)]="product.taxType" name="taxType" />
        </c-col>
        <c-col [md]="12">
          <label cLabel for="imgUrl">Image URL</label>
          <input cFormControl id="imgUrl" [(ngModel)]="product.imgUrl" name="imgUrl" />
        </c-col> -->
        <c-col [md]="12" class="text-end">
          <button cButton color="primary" type="submit" [disabled]="!productForm.form.valid || skuExists || barcodeExists" style="min-width: 120px; height: 40px; font-size: 1rem;">
            <svg cIcon name="cil-save" class="me-2"></svg>Update Product
          </button>
        </c-col>
      </form>
    </div>
  </div>
</div>

