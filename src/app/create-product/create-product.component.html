<div class="container py-4">
  <div *ngIf="loading" class="loading-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:rgba(255,255,255,0.6);display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div style="font-size:1.2rem;color:#0d6efd;font-weight:500;">Creating product...</div>
  </div>
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white d-flex align-items-center">
      <svg cIcon name="cil-plus" class="me-2"></svg>
      <h4 class="mb-0">Create Product</h4>
    </div>
    <div class="card-body">
      <form (ngSubmit)="createProduct()" #productForm="ngForm" cForm class="row g-4">
        <!-- Product Name -->
        <c-col [md]="6">
          <label cLabel for="productName">Part Name</label>
          <input cFormControl id="productName" type="text" [(ngModel)]="product.productName" name="productName" required #productName="ngModel" minlength="2" />
          <div *ngIf="productName.invalid && (productName.dirty || productName.touched)" class="text-danger small">
            <div *ngIf="productName.errors?.['required']">Product name is required.</div>
            <div *ngIf="productName.errors?.['minlength']">Product name must be at least 2 characters.</div>
          </div>
        </c-col>
        <!-- <c-col [md]="6">
          <label cLabel for="make&model">Make & Model</label>
          <input cFormControl id="brandName" type="text" [(ngModel)]="product.brandName" name="brandName" #brandName="ngModel" minlength="2" />
          <div *ngIf="brandName.invalid && (brandName.dirty || brandName.touched)" class="text-danger small">
            <div *ngIf="brandName.errors?.['required']">Brand name is required.</div>
            <div *ngIf="brandName.errors?.['minlength']">Brand name must be at least 2 characters.</div>
          </div>
        </c-col>
        <c-col [md]="6">
          <label cLabel for="year">Year</label>
          <input cFormControl id="year" type="text" [(ngModel)]="product.year" name="year" #year="ngModel" minlength="2" />
          <div *ngIf="year.invalid && (year.dirty || year.touched)" class="text-danger small">
            <div *ngIf="year.errors?.['required']">Year is required.</div>
            <div *ngIf="year.errors?.['minlength']">Year must be at least 2 characters.</div>
          </div>
        </c-col> -->
        <!-- <c-col [md]="6">
          <label cLabel for="brandName">Brand Name</label>
          <input cFormControl id="brandName" type="text" [(ngModel)]="product.brandName" name="brandName" #brandName="ngModel" minlength="2" />
          <div *ngIf="brandName.invalid && (brandName.dirty || brandName.touched)" class="text-danger small">
            <div *ngIf="brandName.errors?.['required']">Brand name is required.</div>
            <div *ngIf="brandName.errors?.['minlength']">Brand name must be at least 2 characters.</div>
          </div>
        </c-col> -->
        <!-- <c-col [md]="6">
          <label cLabel for="partNumber">Part Number</label>
          <input cFormControl id="partNumber" type="text" [(ngModel)]="product.partNumber" name="partNumber" #partNumber="ngModel" minlength="2" />
          <div *ngIf="partNumber.invalid && (partNumber.dirty || partNumber.touched)" class="text-danger small">
            <div *ngIf="partNumber.errors?.['minlength']">Part number must be at least 2 characters.</div>
          </div>
        </c-col> -->
        <!-- <c-col [md]="6">
          <label cLabel for="vehicleModel">Compatible Vehicle Models</label>
          <div class="d-flex align-items-center mb-2">
            <select id="vehicleModelSelect" [(ngModel)]="selectedVehicleId" name="vehicleModelSelect" class="form-select me-2" style="max-width: 60%;">
              <option value="" disabled selected>Select Vehicle Model</option>
              <option *ngFor="let model of vehicleModels" [ngValue]="model.id">{{ model.make }} {{ model.model }} {{ model.year }}</option>
            </select>
            <button cButton color="primary" type="button" (click)="addVehicle()" [disabled]="!selectedVehicleId">Select</button>
            <button cButton color="success" type="button" style="margin-left:8px;" (click)="openCreateVehiclePopup()">
              <svg cIcon name="cil-plus" style="margin-right:2px;"></svg> New Vehicle
            </button>
          </div>
          <div class="mb-2">
            <strong *ngIf="selectedVehicles.length > 0" style="display:block;margin-bottom:4px;">Selected Vehicles:</strong>
            <div *ngIf="selectedVehicles.length > 0" class="d-flex flex-wrap gap-1 p-2 border rounded bg-light" style="min-height:32px;">
              <span *ngFor="let model of selectedVehicles; let i = index" class="d-flex align-items-center px-2 py-1 rounded-pill bg-info" style="font-size:0.92rem;gap:6px;line-height:1.2;box-shadow:0 1px 2px rgba(0,0,0,0.04);">
                <span style="color:#fff;">{{ model.make }} {{ model.model }} {{ model.year }}</span>
                <button type="button" class="btn-close btn-close-white ms-1" aria-label="Remove" (click)="removeVehicle(i)" style="font-size:0.85rem;opacity:0.6;width:18px;height:18px;"></button>
              </span>
            </div>
            <span *ngIf="selectedVehicles.length === 0" class="text-muted">No vehicles selected yet.</span>
          </div>
        </c-col> -->
        <c-col [md]="6">
          <label cLabel for="vehicleModel">Compatible Vehicle Model</label>
          <div class="d-flex align-items-center mb-2">
            <input id="vehicleModelSearch" type="text" class="form-control me-2" [(ngModel)]="vehicleSearchTerm" (input)="searchVehicleModel()" name="vehicleModelSearch" placeholder="Search Vehicle Model" autocomplete="off" style="max-width: 60%;" />
            <button cButton color="success" type="button" style="margin-left:8px;" (click)="openCreateVehiclePopup()">
              <svg cIcon name="cil-plus" style="margin-right:2px;"></svg> New Vehicle
            </button>
            <div *ngIf="vehicleModelResults.length > 0" class="dropdown-list" style="width:60%;position:absolute;z-index:10;">
              <ul class="list-group">
                <li *ngFor="let model of vehicleModelResults" class="list-group-item list-group-item-action" (click)="selectVehicleModel(model)">
                  <span>{{ model.make }} {{ model.model }} {{ model.year }}</span>
                </li>
              </ul>
            </div>
          </div>
        </c-col>
        <!-- Category -->
        <!-- <c-col [md]="6">
          <label cLabel for="category">Category</label>
          <select cFormControl id="category" [(ngModel)]="selectedParentCategoryId" name="category" required #category="ngModel" class="form-select">
            <option value="" disabled selected>Select Category</option>
            <option *ngFor="let category of categories" [value]="category.catId">{{ category.name }}</option>
          </select>
          <div *ngIf="category.invalid && (category.dirty || category.touched)" class="text-danger small">
            <div *ngIf="category.errors?.['required']">Category is required.</div>
          </div>
        </c-col> -->
        <!-- Barcode -->
        <!-- <c-col [md]="6">
          <label cLabel for="barCode">Barcode</label>
          <input cFormControl id="barCode" type="text" [(ngModel)]="product.barCode" name="barCode" #barCode="ngModel" minlength="3" (ngModelChange)="onBarcodeChange($event)" />
          <div *ngIf="barCode.invalid && (barCode.dirty || barCode.touched)" class="text-danger small">
            <div *ngIf="barCode.errors?.['required']">Barcode is required.</div>
            <div *ngIf="barCode.errors?.['minlength']">Barcode must be at least 3 characters.</div>
          </div>
          <div *ngIf="barcodeExists" class="text-danger small">Barcode already exists. Please enter a unique Barcode.</div>
        </c-col> -->
        <!-- Product Type -->
        <!-- <c-col [md]="6">
          <label cLabel for="productType">Product Type</label>
          <select cFormControl id="productType" [(ngModel)]="product.productType" name="productType" required #productType="ngModel" class="form-select">
            <option value="" disabled selected>Select Product Type</option>
            <option value="Standard Product">Standard Product</option>
            <option value="Variable Product">Variable Product</option>
            <option value="Service Product">Service Product</option>
          </select>
          <div *ngIf="productType.invalid && (productType.dirty || productType.touched)" class="text-danger small">
            <div *ngIf="productType.errors?.['required']">Product type is required.</div>
          </div>
        </c-col> -->
        <!-- Low Qty -->
        <c-col [md]="6">
          <label cLabel for="lowQty">Low Qty</label>
          <input cFormControl id="lowQty" [(ngModel)]="product.lowQty" name="lowQty" required #lowQty="ngModel" pattern="^[0-9]+$" />
          <div *ngIf="lowQty.invalid && (lowQty.dirty || lowQty.touched)" class="text-danger small">
            <div *ngIf="lowQty.errors?.['required']">Low Qty is required.</div>
            <div *ngIf="lowQty.errors?.['pattern']">Low Qty must be a number.</div>
          </div>
        </c-col>
        <!-- Description -->
        <c-col [md]="6">
          <label cLabel for="description">Description</label>
          <textarea cFormControl id="description" [(ngModel)]="product.description" name="description" rows="2"></textarea>
        </c-col>
     
        <!-- Tax Group -->
        <!-- <c-col [md]="4">
          <label cLabel for="taxGroup">Tax Group</label>
          <input cFormControl id="taxGroup" [(ngModel)]="product.taxGroup" name="taxGroup" />
        </c-col> -->
        <!-- Tax Type -->
        <!-- <c-col [md]="4">
          <label cLabel for="taxType">Tax Type</label>
          <input cFormControl id="taxType" [(ngModel)]="product.taxType" name="taxType" />
        </c-col> -->
        <!-- Image URL -->
        <!-- <c-col [md]="12">
          <label cLabel for="imgUrl">Image URL</label>
          <input cFormControl id="imgUrl" [(ngModel)]="product.imgUrl" name="imgUrl" />
        </c-col> -->
        <!-- Save Button -->
        <c-col [md]="12" class="text-end">
          <button cButton color="primary" type="submit" [disabled]="!productForm.form.valid || barcodeExists" style="min-width: 120px; height: 40px; font-size: 1rem;">
            <svg cIcon name="cil-save" class="me-2"></svg>Save Product
          </button>
        </c-col>
      </form>
    </div>
  </div>
</div>

