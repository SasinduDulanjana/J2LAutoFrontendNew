<div class="invoice-wrapper" id="invoice-content">
  <div class="invoice-header">
    <img src="/assets/img/letterhead.png" alt="True Enterprises Letterhead" class="letterhead" />
  </div>

  <div class="invoice-body">
    <h2 class="invoice-title">SALE INVOICE</h2>
    <div class="invoice-meta">
      <div class="invoice-meta-left">
        <p><strong>Invoice No:</strong> {{ invoiceData.invoiceNumber }}</p>
        <p><strong>Date:</strong> {{ invoiceData.currentDate }}</p>
        <p><strong>User:</strong> {{ invoiceData.loggedUserName }}</p>
      </div>

      <div class="invoice-meta-right">
        <p><strong>Customer:</strong> {{ invoiceData.selectedCustomerName }}</p>
        <p *ngIf="invoiceData.vehicle"><strong>Vehicle:</strong> {{ invoiceData.vehicle.make }} {{ invoiceData.vehicle.model }} {{ invoiceData.vehicle.year }}</p>
        <p *ngIf="invoiceData.vehicleNumber"><strong>Vehicle No:</strong> {{ invoiceData.vehicleNumber }}</p>
      </div>
    </div>

    <table class="invoice-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Product</th>
          <th>Qty</th>
          <th>Unit Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of invoiceData.saleItems; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ item.productName }}</td>
          <td>{{ item.remainingQty }}</td>
          <td>{{ item.retailPrice | currency: 'LKR ' }}</td>
          <td>
            {{
              ((item.remainingQty ?? 0) * (item.retailPrice ?? 0) -
              ((item.discountPercentage ?? 0) / 100 * (item.retailPrice ?? 0) * (item.remainingQty ?? 0)))
              | currency: 'LKR '
            }}
          </td>
        </tr>
      </tbody>
    </table>

    <div class="invoice-summary">
      <div class="summary-row"><span>Subtotal</span><span>{{ invoiceData.subtotal | currency: 'LKR ' }}</span></div>
      <!-- <div class="summary-row"><span>Line Discount</span><span>{{ invoiceData.totalDiscount | currency: 'LKR ' }}</span></div>
      <div class="summary-row"><span>Bill Discount (%)</span><span>{{ invoiceData.billWiseDiscountPercentage }}%</span></div> -->
      <div class="summary-row"><span>Bill Discount Total</span><span>{{ invoiceData.billWiseDiscountTotal | currency: 'LKR ' }}</span></div>
      <div class="summary-row total"><span>Net Total</span><span>{{ invoiceData.netTotal | currency: 'LKR ' }}</span></div>
      <!-- <div class="summary-row"><span>Paid Amount</span><span>{{ invoiceData.saleItem.paidAmount | currency: 'LKR ' }}</span></div>
      <div class="summary-row status">
        <span>Status</span>
        <span class="status-badge" [ngClass]="{'paid': invoiceData.saleItem.isFullyPaid, 'unpaid': !invoiceData.saleItem.isFullyPaid}">
          {{ invoiceData.saleItem.isFullyPaid ? 'Fully Paid' : 'Partially Paid' }}
        </span>
      </div> -->
    </div>
  </div>

  <div class="invoice-actions no-print">
    <button (click)="printBill()" class="btn primary"><i class="fa fa-print"></i> Print</button>
    <button (click)="startNewTransaction()" class="btn outline"><i class="fa fa-plus"></i> New Sale</button>
  </div>

  <div class="invoice-footer">
    <p class="thank-you">Thank you for your business!</p>
    <p class="footer-note">This invoice was system-generated. For inquiries, contact: <strong>trueenterprises.lk@gmail.com</strong></p>
  </div>
</div>
